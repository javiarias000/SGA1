{% extends 'teachers/base.html' %}

{% block title %}Estudiante - {{ student.name }}{% endblock %}
{% block page_title %}ğŸ‘¤ {{ student.name }}{% endblock %}

{% block content %}
<div class="student-detail-header">
  <div class="student-info-card">
    <div class="student-avatar-large">{{ student.name.0 }}</div>
    <div>
      <h2>{{ student.name }}</h2>
      <p><strong>AÃ±o:</strong> {{ student.grade }}</p>
      {% if student.parent_name %}<p><strong>Padre/Madre:</strong> {{ student.parent_name }}</p>{% endif %}
      {% if student.parent_phone %}<p><strong>TelÃ©fono:</strong> {{ student.parent_phone }}</p>{% endif %}
      {% if student.parent_email %}<p><strong>Email:</strong> {{ student.parent_email }}</p>{% endif %}
      <div class="mt-3" style="display:flex; gap:10px; flex-wrap:wrap;">
        <a href="{% url 'teachers:student_edit' student.id %}" class="btn btn-primary">âœï¸ Editar</a>
        <a href="{% url 'teachers:report_card' student.id %}" class="btn btn-view">ğŸ“’ Libreta</a>
        <button onclick="toggleCode()" class="btn btn-purple">ğŸ”‘ Ver CÃ³digo</button>
        <a href="{% url 'teachers:estudiantes' %}" class="btn btn-secondary">â† Volver</a>
      </div>

      <div id="registration-code-section" class="mt-3" style="display: none;">
        <p><strong>CÃ³digo de Registro del Estudiante:</strong></p>
        <div style="display: flex; align-items: center; gap: 10px; padding: 10px; background: #F3F4F6; border-radius: 8px;">
          <strong id="registration-code" style="font-size: 1.2em; font-family: monospace; color: #4B5563;">{{ student.registration_code }}</strong>
          <button class="btn btn-secondary" onclick="copyCode()">Copiar</button>
        </div>
      </div>
    </div>
  </div>
</div>

<div class="tabs-section mt-20">
  <div class="tabs">
    <button class="tab active" onclick="showSection('activities')">ğŸ“š Clases</button>
    <button class="tab" onclick="showSection('grades')">ğŸ“Š Calificaciones</button>
  </div>

  <div id="activities-section" class="tab-section active">
    <h3 class="mt-20">ğŸ“š Historial de Clases</h3>
    {% for activity in activities %}
      <div class="activity-card mt-20">
        <div class="activity-header">
          <div>
            <h4>Clase #{{ activity.class_number }} - {{ activity.subject }}</h4>
            <p>{{ activity.date|date:"d \\d\\e F \\d\\e Y" }}</p>
          </div>
          <span class="badge badge-{{ activity.performance|lower|slugify }}">{{ activity.performance }}</span>
        </div>
        <div style="margin-top: 15px;">
          <p><strong>Temas:</strong> {{ activity.topics_worked|default:"-" }}</p>
          <p><strong>Repertorio:</strong> {{ activity.pieces|default:"-" }}</p>
        </div>
        <div style="display: flex; gap: 10px; margin-top: 15px; flex-wrap:wrap;">
          <a href="{% url 'teachers:download_parent' activity.id %}" class="btn btn-secondary">ğŸ  Informe Padres</a>
          <a href="{% url 'teachers:download_teacher' activity.id %}" class="btn btn-purple">ğŸ“„ Informe Docente</a>
          <a href="{% url 'teachers:activity_edit' activity.id %}" class="btn btn-view">âœï¸ Editar</a>
          <a href="{% url 'teachers:activity_delete' activity.id %}" class="btn btn-danger">ğŸ—‘ï¸ Eliminar</a>
        </div>
      </div>
    {% empty %}
      <p class="empty-state">No hay clases registradas para este estudiante</p>
    {% endfor %}
  </div>

  <div id="grades-section" class="tab-section">
    <h3 class="mt-20">ğŸ“Š Calificaciones</h3>
    {% for grade in grades %}
      <div class="grade-card mt-20">
        <div class="flex-between">
          <div>
            <h4>{{ grade.subject }}</h4>
            <p>{{ grade.period }}</p>
            <p style="font-size: 13px; color: #6B7280;">{{ grade.date|date:"d M Y" }}</p>
          </div>
          <div class="grade-score">
            <h2>{{ grade.score }}</h2>
            <p>/ 10</p>
          </div>
        </div>
        {% if grade.comments %}
        <p class="mt-20"><strong>Comentarios:</strong> {{ grade.comments }}</p>
        {% endif %}
        <div style="display: flex; gap: 10px; margin-top: 15px; padding-top: 15px; border-top: 1px solid #E5E7EB;">
          <a href="{% url 'teachers:grade_edit' grade.id %}" class="btn btn-view" style="font-size: 13px;">âœï¸ Editar</a>
          <a href="{% url 'teachers:grade_delete' grade.id %}" class="btn btn-danger" style="font-size: 13px; padding: 8px 15px;">ğŸ—‘ï¸ Eliminar</a>
        </div>
      </div>
    {% empty %}
      <p class="empty-state">No hay calificaciones registradas</p>
    {% endfor %}
  </div>
</div>

<script>
function showSection(section) {
  document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
  document.querySelectorAll('.tab-section').forEach(s => s.classList.remove('active'));
  event.target.classList.add('active');
  document.getElementById(section + '-section').classList.add('active');
}

function copyCode() {
  const code = document.getElementById('registration-code').innerText;
  navigator.clipboard.writeText(code).then(() => {
    alert('CÃ³digo copiado al portapapeles');
  }, () => {
    alert('Error al copiar el cÃ³digo');
  });
}

function toggleCode() {
  const codeSection = document.getElementById('registration-code-section');
  if (codeSection.style.display === 'none') {
    codeSection.style.display = 'block';
  } else {
    codeSection.style.display = 'none';
  }
}
</script>

<style>
.student-detail-header { display: grid; grid-template-columns: 2fr 1fr; gap: 20px; margin-bottom: 30px; }
.student-info-card { background: white; padding: 30px; border-radius: 15px; box-shadow: 0 2px 10px rgba(0,0,0,0.05); display: flex; gap: 20px; align-items: center; }
.student-avatar-large { width: 100px; height: 100px; border-radius: 50%; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); display: flex; align-items: center; justify-content: center; color: white; font-size: 3em; font-weight: bold; }
.tabs-section .tabs { display: flex; gap: 10px; background: white; padding: 10px; border-radius: 15px; margin-bottom: 20px; }
.tabs-section .tab { flex: 1; padding: 15px; background: transparent; border: none; border-radius: 10px; font-size: 16px; font-weight: bold; cursor: pointer; transition: all 0.3s; }
.tabs-section .tab:hover { background: #F3F4F6; }
.tabs-section .tab.active { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; }
.tab-section { display: none; }
.tab-section.active { display: block; }
.activity-card, .grade-card { background: white; padding: 20px; border-radius: 15px; box-shadow: 0 2px 10px rgba(0,0,0,0.05); }
.activity-header { display: flex; justify-content: space-between; align-items: center; }
.badge { padding: 6px 10px; border-radius: 8px; font-size: 12px; }
</style>
{% endblock %}

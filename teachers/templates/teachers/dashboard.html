{% extends 'teachers/base.html' %}

{% block title %}Dashboard - Sistema Musical{% endblock %}
{% block page_title %}Dashboard{% endblock %}

{% block content %}
<div class="dashboard-grid">
    <!-- Stats Cards -->
    <div class="stats-container">
        <div class="stat-card stat-blue">
            <div class="stat-icon">üë•</div>
            <div class="stat-content">
                <h3>{{ total_students }}</h3>
                <p>Estudiantes Activos</p>
            </div>
        </div>
        
        <div class="stat-card stat-green">
            <div class="stat-icon">üìö</div>
            <div class="stat-content">
                <h3>{{ total_classes }}</h3>
                <p>Clases Registradas</p>
            </div>
        </div>
        
        <div class="stat-card stat-orange">
            <div class="stat-icon">üìÖ</div>
            <div class="stat-content">
                <h3>{{ today_classes.count }}</h3>
                <p>Clases de Hoy</p>
            </div>
        </div>
    </div>

<form method="post">
        {% csrf_token %}
        <input type="hidden" name="action" value="save_all_entry">
        <div class="dashboard-section">
            <h2>‚ö° Registro Unificado</h2>
            <div style="display: grid; grid-template-columns: 1fr; gap: 16px;">
                <!-- Comunes -->
                <div class="card">
                    <h3>üéõÔ∏è Par√°metros Comunes</h3>
                    <div class="row g-3">
                        <div class="col-md-4">{{ unified_form.common_student.label_tag }} {{ unified_form.common_student }}</div>
                        <div class="col-md-4">{{ unified_form.common_subject.label_tag }} {{ unified_form.common_subject }}</div>
                        <div class="col-md-4">{{ unified_form.common_date.label_tag }} {{ unified_form.common_date }}</div>
                    </div>
                </div>

                <!-- Clase -->
                <div class="card">
                    <h3>üìö Clase</h3>
                    <div class="row g-3">
                        <div class="col-md-4">{{ unified_form.performance.label_tag }} {{ unified_form.performance }}</div>
                        <div class="col-md-4">{{ unified_form.practice_time.label_tag }} {{ unified_form.practice_time }}</div>
                        <div class="col-md-4">{{ unified_form.pieces.label_tag }} {{ unified_form.pieces }}</div>
                        <div class="col-12">{{ unified_form.topics_worked.label_tag }} {{ unified_form.topics_worked }}</div>
                        <div class="col-12">{{ unified_form.techniques.label_tag }} {{ unified_form.techniques }}</div>
                        <div class="col-12">{{ unified_form.strengths.label_tag }} {{ unified_form.strengths }}</div>
                        <div class="col-12">{{ unified_form.areas_to_improve.label_tag }} {{ unified_form.areas_to_improve }}</div>
                        <div class="col-12">{{ unified_form.homework.label_tag }} {{ unified_form.homework }}</div>
                        <div class="col-12">{{ unified_form.observations.label_tag }} {{ unified_form.observations }}</div>
                    </div>
                </div>

                <!-- Asistencia -->
                <div class="card">
                    <h3>‚úÖ Asistencia</h3>
                    <div class="row g-3">
                        <div class="col-md-4">{{ unified_form.attendance_status.label_tag }} {{ unified_form.attendance_status }}</div>
                        <div class="col-12">{{ unified_form.attendance_notes.label_tag }} {{ unified_form.attendance_notes }}</div>
                    </div>
                </div>

                <!-- Calificaci√≥n (opcional) -->
                <div class="card">
                    <h3>üìä Calificaci√≥n</h3>
                    <div class="row g-3">
                        <div class="col-md-6">{{ unified_form.grade_period.label_tag }} {{ unified_form.grade_period }}</div>
                        <div class="col-md-6">{{ unified_form.grade_score.label_tag }} {{ unified_form.grade_score }}</div>
                        <div class="col-12">{{ unified_form.grade_comments.label_tag }} {{ unified_form.grade_comments }}</div>
                    </div>
                </div>
                <div>
                    <button type="submit" class="btn btn-primary">Guardar todo</button>
                </div>
            </div>
        </div>
    </form>
    
    <!-- Clases de Hoy -->
    {% if today_classes %}
    <div class="dashboard-section">
        <h2>üìÖ Clases de Hoy</h2>
        <div class="classes-today">
            {% for activity in today_classes %}
            <div class="class-card">
                <div class="class-info">
                    <h4>{{ activity.student.name }}</h4>
                    <p>{{ activity.subject }} - Clase #{{ activity.class_number }}</p>
                </div>
                <span class="badge badge-{{ activity.performance|lower|slugify }}">{{ activity.performance }}</span>
            </div>
            {% endfor %}
        </div>
    </div>
    {% endif %}
    
    <!-- Estudiantes Recientes -->
    <div class="dashboard-section">
        <h2>üë• Estudiantes Recientes</h2>
        <div class="student-list">
            {% for student in recent_students %}
            <div class="student-item">
                <div class="student-avatar">{{ student.name.0 }}</div>
                <div class="student-info">
                    <h4>{{ student.name }}</h4>
                    <p>{{ student.grade }} ‚Ä¢ {{ student.get_class_count }} clases</p>
                </div>
                <a href="{% url 'teachers:student_detail' student.id %}" class="btn-view">Ver</a>
            </div>
            {% endfor %}
        </div>
    </div>
    
    <!-- Actividades Recientes -->
    <div class="dashboard-section">
        <h2>üìö Actividades Recientes</h2>
        <div class="activity-list">
            {% for activity in recent_activities %}
            <div class="activity-item">
                <div class="activity-date">{{ activity.date|date:"d M" }}</div>
                <div class="activity-info">
                    <h4>{{ activity.student.name }}</h4>
                    <p>{{ activity.subject }} - Clase #{{ activity.class_number }}</p>
                </div>
                <span class="badge badge-{{ activity.performance|lower|slugify }}">{{ activity.performance }}</span>
            </div>
            {% endfor %}
        </div>
    </div>
</div>
{% endblock %}

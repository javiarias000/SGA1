{% extends 'students/base.html' %}

{% block title %}Mis Clases{% endblock %}

{% block content %}
<div class="container-narrow">
  <h1 class="mb-4">ğŸ“š Mis Clases</h1>
  <p class="text-muted mb-4">Historial y matrÃ­cula en clases teÃ³ricas</p>

  <!-- Disponibles para matricularse -->
  <div class="card mb-4">
    <div class="d-flex justify-content-between align-items-center mb-3">
      <h3 class="mb-0">Clases disponibles</h3>
    </div>
    {% if clases_disponibles %}
      <div class="row g-3">
        {% for c in clases_disponibles %}
          <div class="col-12 col-md-6">
            <div class="card h-100">
              <div class="d-flex justify-content-between">
                <div>
                  <h5 class="mb-1">{{ c.subject }} â€¢ {{ c.name }}</h5>
                  <p class="mb-1 text-muted">Docente: {{ c.teacher.full_name }}</p>
                  {% if c.schedule %}<p class="mb-1 text-muted">Horario: {{ c.schedule }}</p>{% endif %}
                  {% if c.room %}<p class="mb-1 text-muted">Aula: {{ c.room }}</p>{% endif %}
                  <small class="text-muted">Cupos: {{ c.get_enrolled_count }} / {{ c.max_students }}</small>
                </div>
                <div>
                  <a class="btn btn-primary" href="{% url 'students:enroll' c.id %}">Matricularme</a>
                </div>
              </div>
            </div>
          </div>
        {% endfor %}
      </div>
    {% else %}
      <p class="text-muted">No hay clases disponibles para matricularse en este momento.</p>
    {% endif %}
  </div>

  <!-- Clases ya matriculadas -->
  <div class="card mb-4">
    <h3 class="mb-3">Mis clases matriculadas</h3>
    {% if mis_clases %}
      <div class="row g-3">
        {% for c in mis_clases %}
          <div class="col-12 col-md-6">
            <div class="card h-100">
              <h5 class="mb-1">{{ c.subject }} â€¢ {{ c.name }}</h5>
              <p class="mb-1 text-muted">Docente: {{ c.teacher.full_name }}</p>
              <small class="text-muted">Cupos: {{ c.get_enrolled_count }} / {{ c.max_students }}</small>
            </div>
          </div>
        {% endfor %}
      </div>
    {% else %}
      <p class="text-muted">AÃºn no estÃ¡s matriculado en ninguna clase.</p>
    {% endif %}
  </div>

  <!-- Historial de actividades -->
  <div class="mb-3">
    <form method="get" class="row g-3 align-items-end">
      <div class="col-12 col-md-6">
        <label class="form-label">Filtrar por materia</label>
        <select name="subject" class="form-select" onchange="this.form.submit()">
          <option value="">Todas las materias</option>
          {% for subject in student.get_subjects %}
            <option value="{{ subject }}" {% if subject_filter == subject %}selected{% endif %}>{{ subject }}</option>
          {% endfor %}
        </select>
      </div>
      <div class="col-12 col-md-3">
        <button type="submit" class="btn btn-outline-secondary">Aplicar</button>
      </div>
    </form>
  </div>

  {% for subject, subject_activities in activities_by_subject.items %}
    <div class="mb-4">
      <h4 class="mb-3">{% if 'Guitarra' in subject %}ğŸ¸{% elif 'Conjunto' in subject %}ğŸº{% else %}ğŸµ{% endif %} {{ subject }} ({{ subject_activities|length }} clases)</h4>
      <div class="d-grid gap-3">
        {% for activity in subject_activities %}
          <div class="card">
            <div class="d-flex justify-content-between align-items-start mb-2">
              <div>
                <h6 class="mb-1">Clase #{{ activity.class_number }}</h6>
                <small class="text-muted">{{ activity.date|date:"d M Y" }}</small>
              </div>
              <span class="badge rounded-pill text-bg-
                {% if activity.performance == 'Excelente' %}success
                {% elif activity.performance == 'Muy Bueno' or activity.performance == 'Bueno' %}warning
                {% else %}danger{% endif %}">
                {{ activity.performance }}
              </span>
            </div>
            <div class="bg-light p-3 rounded">
              <p class="mb-2"><strong>ğŸ“– Temas:</strong> {{ activity.topics_worked|default:"-" }}</p>
              <p class="mb-2"><strong>ğŸ¼ TÃ©cnicas:</strong> {{ activity.techniques|default:"-" }}</p>
              <p class="mb-2"><strong>ğŸµ Repertorio:</strong> {{ activity.pieces|default:"-" }}</p>
              <p class="mb-2"><strong>âœ¨ Fortalezas:</strong> {{ activity.strengths|default:"-" }}</p>
              <p class="mb-2"><strong>ğŸ¯ A mejorar:</strong> {{ activity.areas_to_improve|default:"-" }}</p>
              <p class="mb-0"><strong>ğŸ  Tarea:</strong> {{ activity.homework|default:"Sin tareas" }}</p>
            </div>
          </div>
        {% endfor %}
      </div>
    </div>
  {% empty %}
    <p class="text-center text-muted py-5">No tienes clases registradas</p>
  {% endfor %}
</div>
{% endblock %}
